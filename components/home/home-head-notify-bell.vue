<template>
  <nuxt-link :to="localePath('/notify')" class="relative w-6 h-6 ml-4 transition duration-200 hover:opacity-75">
    <svg class="h-full">
      <path
        d="M12 1.95634C13.5366 1.95846 15.0096 2.56979 16.0961 3.65629C17.1826 4.74279 17.7939 6.2158 17.796 7.75234V12.8003C17.796 13.0798 17.8611 13.3554 17.9861 13.6053C18.111 13.8553 18.2925 14.0727 18.516 14.2403C19.1497 14.7172 19.6475 15.3515 19.96 16.0803H4.04003C4.35493 15.3573 4.85257 14.7287 5.48403 14.2563C5.70758 14.0887 5.88903 13.8713 6.014 13.6213C6.13897 13.3714 6.20403 13.0958 6.20403 12.8163V7.93234C6.20403 4.73234 8.70803 2.06834 11.804 1.95634H12ZM12 0.156344H11.724C7.60003 0.304344 4.40003 3.81634 4.40003 7.93234V12.8003C3.46007 13.506 2.73445 14.4587 2.30403 15.5523C2.20234 15.8112 2.16587 16.091 2.19781 16.3673C2.22975 16.6435 2.32913 16.9077 2.48719 17.1365C2.64526 17.3653 2.85716 17.5517 3.10423 17.6793C3.3513 17.8069 3.62596 17.8719 3.90403 17.8683H20.112C20.3901 17.8719 20.6648 17.8069 20.9118 17.6793C21.1589 17.5517 21.3708 17.3653 21.5289 17.1365C21.6869 16.9077 21.7863 16.6435 21.8182 16.3673C21.8502 16.091 21.8137 15.8112 21.712 15.5523C21.2772 14.4567 20.5459 13.5038 19.6 12.8003V7.75234C19.6 5.7367 18.7993 3.80361 17.374 2.37833C15.9488 0.953056 14.0157 0.152344 12 0.152344V0.156344Z"
        fill="white"
      />
      <path
        d="M12 23.8441C10.8887 23.8476 9.81243 23.4556 8.96376 22.7381C8.11509 22.0206 7.54944 21.0245 7.36803 19.9281C7.32877 19.6926 7.38469 19.4512 7.52346 19.2569C7.66224 19.0626 7.87251 18.9314 8.10803 18.8921C8.34354 18.8529 8.585 18.9088 8.77929 19.0476C8.97357 19.1864 9.10477 19.3966 9.14403 19.6321C9.25999 20.3061 9.6104 20.9174 10.1334 21.358C10.6563 21.7987 11.3182 22.0404 12.002 22.0404C12.6859 22.0404 13.3477 21.7987 13.8707 21.358C14.3937 20.9174 14.7441 20.3061 14.86 19.6321C14.8795 19.5155 14.9217 19.4039 14.9843 19.3036C15.0468 19.2033 15.1286 19.1163 15.2248 19.0476C15.321 18.9789 15.4298 18.9298 15.5449 18.9031C15.6601 18.8764 15.7794 18.8727 15.896 18.8921C16.0126 18.9116 16.1243 18.9538 16.2246 19.0164C16.3249 19.079 16.4119 19.1607 16.4806 19.2569C16.5493 19.3531 16.5984 19.4619 16.6251 19.577C16.6517 19.6922 16.6555 19.8115 16.636 19.9281C16.4537 21.0249 15.8873 22.021 15.038 22.7384C14.1886 23.4559 13.1118 23.8478 12 23.8441Z"
        fill="white"
      />
    </svg>
    <div v-if="countUnread > 0" class="w-2 h-2 rounded-full bg-red-500 absolute top-0 right-0"></div>
  </nuxt-link>
</template>

<script>
import store from 'store'
import { adminServer } from '../../filecoin/filecoin.config'

export default {
  data() {
    return {
      countUnread: 0
    }
  },

  mounted() {
    this.getCountUnread()
    window.resetUnread = () => {
      this.countUnread = 0
    }
  },

  methods: {
    async getAllIds() {
      const { result: { blogs } } = await this.$axios.$get(`${adminServer}/api/blog/list`, { params: { limit: 100000 } })
      return blogs.map(({ _id }) => _id)
    },

    async getCountUnread() {
      const idsAll = await this.getAllIds()
      const idsReaded = store.get('notify_ids_readed') || []
      this.countUnread = idsAll.length - idsReaded.length
    }
  }
}
</script>
